<div class="add-procedure-page">
  <div class="header">
    <h1 class="page-title">Ajouter une nouvelle proc√©dure</h1>
    <p class="page-description">Remplissez tous les d√©tails pour cr√©er une proc√©dure compl√®te.</p>
  </div>

  <!-- Messages -->
  <div *ngIf="successMessage" class="alert alert-success">
    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
    </svg>
    {{ successMessage }}
  </div>

  <div *ngIf="errorMessage" class="alert alert-error">
    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
    </svg>
    {{ errorMessage }}
  </div>

  <form (ngSubmit)="saveProcedure()">
    <!-- SECTION 1: Informations de base -->
    <div class="form-section">
      <h2 class="section-title">üìã Informations de base</h2>

      <div class="form-group">
        <label for="nom">Nom * (max 200 caract√®res)</label>
        <input type="text" id="nom" [(ngModel)]="nom" name="nom" 
               placeholder="Ex: Obtenir une carte d'identit√© nationale (NINA)"
               class="form-input" required maxlength="200" />
      </div>

      <div class="form-group">
        <label for="titre">Titre * (max 100 caract√®res)</label>
        <input type="text" id="titre" [(ngModel)]="titre" name="titre" 
               placeholder="Ex: Carte d'identit√© nationale biom√©trique"
               class="form-input" required maxlength="100" />
      </div>

      <div class="form-group">
        <label for="delai">D√©lai * (max 500 caract√®res)</label>
        <input type="text" id="delai" [(ngModel)]="delai" name="delai"
               placeholder="Ex: 2 semaines" class="form-input" required maxlength="500" />
      </div>

      <div class="form-group">
        <label for="description">Description (optionnel)</label>
        <textarea id="description" [(ngModel)]="description" name="description"
                  placeholder="Description d√©taill√©e de la proc√©dure"
                  class="form-textarea" rows="4"></textarea>
      </div>

      <div class="form-group">
        <label for="urlVersFormulaire">URL vers formulaire (optionnel, max 500 caract√®res)</label>
        <input type="url" id="urlVersFormulaire" [(ngModel)]="urlVersFormulaire" name="urlVersFormulaire" 
               placeholder="Ex: https://nina.gouv.ml/formulaire"
               class="form-input" maxlength="500" />
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="categorieId">Cat√©gorie *</label>
          <select id="categorieId" [(ngModel)]="categorieId" name="categorieId"
                  class="form-input" required [disabled]="isCategoriesLoading">
            <option [value]="null">S√©lectionnez une cat√©gorie</option>
            <option *ngFor="let category of categories" [value]="category.id">
              {{ category.titre }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="sousCategorieId">Sous-cat√©gorie</label>
          <select id="sousCategorieId" [(ngModel)]="sousCategorieId" name="sousCategorieId"
                  class="form-input" [disabled]="isSousCategoriesLoading">
            <option [value]="null">Aucune</option>
            <option *ngFor="let subcat of sousCategories" [value]="subcat.id">
              {{ subcat.titre }}
            </option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="cout">Co√ªt (FCFA) - Optionnel</label>
          <input type="number" id="cout" [(ngModel)]="cout" name="cout"
                 placeholder="Ex: 2000" class="form-input" min="0" />
        </div>

        <div class="form-group">
          <label for="coutId">ID Co√ªt - Optionnel</label>
          <input type="number" id="coutId" [(ngModel)]="coutId" name="coutId"
                 placeholder="ID du co√ªt associ√©" class="form-input" min="1" />
        </div>

        <div class="form-group">
          <label for="centreId">ID Centre - Optionnel</label>
          <input type="number" id="centreId" [(ngModel)]="centreId" name="centreId"
                 placeholder="ID du centre" class="form-input" min="1" />
        </div>
      </div>
    </div>

    <!-- SECTION 2: Pr√©requis -->
    <div class="form-section">
      <h2 class="section-title">‚úì Pr√©requis</h2>
      
      <div class="add-item-group">
        <input type="text" [(ngModel)]="newPrerequis" name="newPrerequis"
               placeholder="Ex: √ätre de nationalit√© malienne"
               class="form-input" />
        <button type="button" class="btn-add-item" (click)="addPrerequis()">
          Ajouter
        </button>
      </div>

      <div class="item-list">
        <div *ngFor="let item of prerequis; let i = index" class="list-item">
          <span>{{ item }}</span>
          <button type="button" class="btn-remove-small" (click)="removePrerequis(i)">√ó</button>
        </div>
      </div>
    </div>

    <!-- SECTION 3: √âtapes -->
    <div class="form-section">
      <h2 class="section-title">üìç √âtapes de la proc√©dure</h2>

      <div class="form-row">
        <div class="form-group" style="flex: 0 0 100px;">
          <label for="stepNumero">N¬∞</label>
          <input type="number" id="stepNumero" [(ngModel)]="stepNumero" name="stepNumero"
                 placeholder="1" class="form-input" min="1" />
        </div>
        <div class="form-group" style="flex: 1;">
          <label for="stepTitre">Titre de l'√©tape</label>
          <input type="text" id="stepTitre" [(ngModel)]="stepTitre" name="stepTitre"
                 placeholder="Ex: Se rendre au centre d'enr√¥lement" class="form-input" />
        </div>
      </div>

      <div class="form-group">
        <label for="stepDescription">Description</label>
        <textarea id="stepDescription" [(ngModel)]="stepDescription" name="stepDescription"
                  placeholder="Description d√©taill√©e de l'√©tape"
                  class="form-textarea" rows="2"></textarea>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="stepDuree">Dur√©e</label>
          <input type="text" id="stepDuree" [(ngModel)]="stepDuree" name="stepDuree"
                 placeholder="Ex: 1 jour" class="form-input" />
        </div>
        <div class="form-group">
          <label for="stepCout">Co√ªt (FCFA)</label>
          <input type="number" id="stepCout" [(ngModel)]="stepCout" name="stepCout"
                 placeholder="0" class="form-input" min="0" />
        </div>
      </div>

      <button type="button" class="btn-add-section" (click)="addStep()">
        + Ajouter cette √©tape
      </button>

      <div class="items-grid">
        <div *ngFor="let step of etapes; let i = index" class="grid-item">
          <div class="item-badge">√âtape {{ step.numero }}</div>
          <strong>{{ step.titre }}</strong>
          <p>{{ step.description }}</p>
          <small>Dur√©e: {{ step.duree || '‚Äî' }} | Co√ªt: {{ step.cout }} FCFA</small>
          <button type="button" class="btn-remove-grid" (click)="removeStep(i)">√ó</button>
        </div>
      </div>
    </div>

    <!-- SECTION 4: Documents requis -->
    <div class="form-section">
      <h2 class="section-title">üìÑ Documents requis</h2>

      <div class="form-group">
        <label for="documentNom">Nom du document</label>
        <input type="text" id="documentNom" [(ngModel)]="documentNom" name="documentNom"
               placeholder="Ex: Extrait d'acte de naissance" class="form-input" />
      </div>

      <div class="form-group">
        <label for="documentDescription">Description</label>
        <input type="text" id="documentDescription" [(ngModel)]="documentDescription" name="documentDescription"
               placeholder="Ex: Original + photocopie" class="form-input" />
      </div>

      <div class="form-group">
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="documentObligatoire" name="documentObligatoire" />
          <span>Obligatoire</span>
        </label>
      </div>

      <button type="button" class="btn-add-section" (click)="addDocument()">
        + Ajouter ce document
      </button>

      <div class="items-grid">
        <div *ngFor="let doc of documentsRequis; let i = index" class="grid-item">
          <div class="item-badge" [class.required]="doc.obligatoire">
            {{ doc.obligatoire ? 'Obligatoire' : 'Optionnel' }}
          </div>
          <strong>{{ doc.nom }}</strong>
          <p>{{ doc.description }}</p>
          <button type="button" class="btn-remove-grid" (click)="removeDocument(i)">√ó</button>
        </div>
      </div>
    </div>

    <!-- SECTION 5: Centres -->
    <div class="form-section">
      <h2 class="section-title">üìç Centres de traitement</h2>

      <div class="form-group">
        <label for="centreNom">Nom du centre</label>
        <input type="text" id="centreNom" [(ngModel)]="centreNom" name="centreNom"
               placeholder="Ex: Centre d'enr√¥lement Commune III" class="form-input" />
      </div>

      <div class="form-group">
        <label for="centreAdresse">Adresse</label>
        <input type="text" id="centreAdresse" [(ngModel)]="centreAdresse" name="centreAdresse"
               placeholder="Ex: Avenue Moussa Trav√©l√©, Bamako" class="form-input" />
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="centreTelephone">T√©l√©phone</label>
          <input type="tel" id="centreTelephone" [(ngModel)]="centreTelephone" name="centreTelephone"
                 placeholder="+22320123456" class="form-input" />
        </div>
        <div class="form-group">
          <label for="centreEmail">Email</label>
          <input type="email" id="centreEmail" [(ngModel)]="centreEmail" name="centreEmail"
                 placeholder="centre@example.ml" class="form-input" />
        </div>
      </div>

      <div class="form-group">
        <label for="centreHoraires">Horaires</label>
        <input type="text" id="centreHoraires" [(ngModel)]="centreHoraires" name="centreHoraires"
               placeholder="Ex: Lundi-Vendredi: 8h-16h" class="form-input" />
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="centreLatitude">Latitude</label>
          <input type="number" id="centreLatitude" [(ngModel)]="centreLatitude" name="centreLatitude"
                 placeholder="12.6392" class="form-input" step="0.0001" />
        </div>
        <div class="form-group">
          <label for="centreLongitude">Longitude</label>
          <input type="number" id="centreLongitude" [(ngModel)]="centreLongitude" name="centreLongitude"
                 placeholder="-8.0029" class="form-input" step="0.0001" />
        </div>
      </div>

      <button type="button" class="btn-add-section" (click)="addCentre()">
        + Ajouter ce centre
      </button>

      <div class="items-grid">
        <div *ngFor="let centre of centres; let i = index" class="grid-item">
          <strong>{{ centre.nom }}</strong>
          <p>üìç {{ centre.adresse }}</p>
          <small>üìû {{ centre.telephone }} | üìß {{ centre.email }}</small>
          <small>üïê {{ centre.horaires }}</small>
          <button type="button" class="btn-remove-grid" (click)="removeCentre(i)">√ó</button>
        </div>
      </div>
    </div>

    <!-- SECTION 6: Lois et Articles -->
    <div class="form-section">
      <h2 class="section-title">‚öñÔ∏è Lois et Articles</h2>

      <div class="form-group">
        <label for="loiTitre">Titre de la loi</label>
        <input type="text" id="loiTitre" [(ngModel)]="loiTitre" name="loiTitre"
               placeholder="Ex: Loi N¬∞2013-031" class="form-input" />
      </div>

      <div class="form-group">
        <label for="loiContenu">Contenu</label>
        <textarea id="loiContenu" [(ngModel)]="loiContenu" name="loiContenu"
                  placeholder="Loi relative √† la carte d'identit√© biom√©trique NINA"
                  class="form-textarea" rows="3"></textarea>
      </div>

      <div class="form-group">
        <label for="loiUrl">URL</label>
        <input type="url" id="loiUrl" [(ngModel)]="loiUrl" name="loiUrl"
               placeholder="https://www.legimali.ml/loi-2013-031" class="form-input" />
      </div>

      <button type="button" class="btn-add-section" (click)="addLoi()">
        + Ajouter cette loi
      </button>

      <div class="items-grid">
        <div *ngFor="let loi of loisArticles; let i = index" class="grid-item">
          <strong>{{ loi.titre }}</strong>
          <p>{{ loi.contenu }}</p>
          <small *ngIf="loi.url">üîó {{ loi.url }}</small>
          <button type="button" class="btn-remove-grid" (click)="removeLoi(i)">√ó</button>
        </div>
      </div>
    </div>

    <!-- SECTION 7: Conseils -->
    <div class="form-section">
      <h2 class="section-title">üí° Conseils pratiques</h2>
      
      <div class="add-item-group">
        <input type="text" [(ngModel)]="newConseil" name="newConseil"
               placeholder="Ex: Arriver t√¥t le matin pour √©viter la queue"
               class="form-input" />
        <button type="button" class="btn-add-item" (click)="addConseil()">
          Ajouter
        </button>
      </div>

      <div class="item-list">
        <div *ngFor="let item of conseils; let i = index" class="list-item">
          <span>{{ item }}</span>
          <button type="button" class="btn-remove-small" (click)="removeConseil(i)">√ó</button>
        </div>
      </div>
    </div>

    <!-- SECTION 8: Pi√®ces justificatives -->
    <div class="form-section">
      <h2 class="section-title">üìé Pi√®ces justificatives</h2>
      
      <div class="add-item-group">
        <input type="text" [(ngModel)]="newPieceJustificative" name="newPieceJustificative"
               placeholder="Ex: Extrait d'acte de naissance original"
               class="form-input" />
        <button type="button" class="btn-add-item" (click)="addPieceJustificative()">
          Ajouter
        </button>
      </div>

      <div class="item-list">
        <div *ngFor="let item of piecesJustificatives; let i = index" class="list-item">
          <span>{{ item }}</span>
          <button type="button" class="btn-remove-small" (click)="removePieceJustificative(i)">√ó</button>
        </div>
      </div>
    </div>

    <!-- SECTION 9: URL de r√©f√©rences -->
    <div class="form-section">
      <h2 class="section-title">üîó URL de r√©f√©rences</h2>
      
      <div class="add-item-group">
        <input type="url" [(ngModel)]="newUrlReference" name="newUrlReference"
               placeholder="https://www.example.ml"
               class="form-input" />
        <button type="button" class="btn-add-item" (click)="addUrlReference()">
          Ajouter
        </button>
      </div>

      <div class="item-list">
        <div *ngFor="let item of urlReferences; let i = index" class="list-item">
          <span>{{ item }}</span>
          <button type="button" class="btn-remove-small" (click)="removeUrlReference(i)">√ó</button>
        </div>
      </div>
    </div>

    <!-- Actions -->
    <div class="form-actions">
      <button type="submit" class="btn-save" [disabled]="isLoading">
        <span *ngIf="isLoading" class="spinner"></span>
        {{ isLoading ? 'Enregistrement...' : 'Sauvegarder la proc√©dure' }}
      </button>
      <button type="button" class="btn-cancel" (click)="cancel()" [disabled]="isLoading">
        Annuler
      </button>
    </div>
  </form>
</div>
