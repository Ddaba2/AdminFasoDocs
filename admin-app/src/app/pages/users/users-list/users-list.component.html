<div class="users-page">
  <div class="header">
    <h1 class="page-title">Gestion des utilisateurs</h1>
    <button class="btn-add" (click)="addUser()">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
        <path d="M8 0C8.41421 0 8.75 0.335786 8.75 0.75V7.25H15.25C15.6642 7.25 16 7.58579 16 8C16 8.41421 15.6642 8.75 15.25 8.75H8.75V15.25C8.75 15.6642 8.41421 16 8 16C7.58579 16 7.25 15.6642 7.25 15.25V8.75H0.75C0.335786 8.75 0 8.41421 0 8C0 7.58579 0.335786 7.25 0.75 7.25H7.25V0.75C7.25 0.335786 7.58579 0 8 0Z"/>
      </svg>
      Ajouter un utilisateur
    </button>
  </div>

  <div *ngIf="successMessage" class="alert alert-success">
    {{ successMessage }}
  </div>

  <div *ngIf="error" class="alert alert-error">
    {{ error }}
  </div>

  <div *ngIf="isLoading" class="loading">
    <p>Chargement des utilisateurs...</p>
  </div>

  <div *ngIf="!isLoading && users.length === 0" class="no-data">
    <p>Aucun utilisateur trouvé.</p>
  </div>

  <!-- Users Table -->
  <div class="table-container" *ngIf="!isLoading && users.length > 0">
    <table class="users-table">
      <thead>
        <tr>
          <th>Nom</th>
          <th>Prénom</th>
          <th>Email</th>
          <th>Numéro de téléphone</th>
          <th>Rôle</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of users" [class.user-inactive]="!user.estActif">
          <td>{{ user.nom }}</td>
          <td>{{ user.prenom }}</td>
          <td>{{ user.email }}</td>
          <td>{{ user.telephone }}</td>
          <td>{{ user.role === 'ADMIN' ? 'Administrateur' : 'Utilisateur' }}</td>
          <td>
            <span class="status-badge" [class.status-active]="user.estActif" [class.status-inactive]="!user.estActif">
              {{ user.estActif ? '✅ Actif' : '❌ Inactif' }}
            </span>
          </td>
          <td class="actions">
            <!-- Bouton Activer (affiché si l'utilisateur est inactif) -->
            <button *ngIf="!user.estActif" 
                    class="btn-activate" 
                    (click)="activateUser(user.id)" 
                    title="Activer cet utilisateur">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/>
              </svg>
            </button>
            
            <!-- Bouton Désactiver (affiché si l'utilisateur est actif) -->
            <button *ngIf="user.estActif" 
                    class="btn-deactivate" 
                    (click)="deactivateUser(user.id)" 
                    [disabled]="isLastActiveAdmin(user)"
                    [title]="isLastActiveAdmin(user) ? 'Impossible de désactiver le dernier admin actif' : 'Désactiver cet utilisateur'">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
              </svg>
            </button>
            
            <!-- Bouton Supprimer -->
            <button class="btn-delete" 
                    (click)="deleteUser(user.id)" 
                    [disabled]="isLastAdmin(user)"
                    [title]="isLastAdmin(user) ? 'Impossible de supprimer le dernier administrateur' : 'Supprimer cet utilisateur'">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
              </svg>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Note informative -->
  <div *ngIf="!isLoading && users.length > 0" class="alert alert-info">
    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" style="margin-right: 8px;">
      <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
    </svg>
    <div>
      <strong>ℹ️ Informations importantes :</strong>
      <ul>
        <li>Les utilisateurs <strong>inactifs</strong> ne peuvent pas se connecter à l'application</li>
        <li>Le dernier administrateur actif <strong>ne peut pas être désactivé</strong></li>
        <li>Le dernier administrateur (actif ou non) <strong>ne peut pas être supprimé</strong></li>
        <li>Ces protections garantissent qu'il y a toujours au moins un administrateur dans le système</li>
      </ul>
    </div>
  </div>
</div>